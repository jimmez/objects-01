<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Objects 01 - v02 ‚Äî Objects Slideshow (Commons)</title>
<meta name="description" content="Objects slideshow that fetches random photos from Wikimedia Commons categories per location. Swipe pages reliably, seamless image swaps, left-rail controls, auto-apply selection. Defaults: 4s slide, 2s reveal." />
<style>
  :root { --bg:#0b0f14; --fg:#e5eef7; --accent:#60a5fa; --ok:#34d399; --panel:#0f172a; --muted:#9fb7d6; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    background:var(--bg); color:var(--fg);
    display:grid; grid-template-rows:auto auto 1fr auto;
  }
  header{display:flex; align-items:center; gap:10px; padding:10px 12px; background:#111827; position:sticky; top:0; z-index:1000}
  h1{font-size:16px; margin:0}
  .sp{flex:1}
  .iconBtn{width:36px; height:36px; display:grid; place-items:center; border-radius:10px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); cursor:pointer}
  .badge{font-size:12px; padding:4px 8px; border:1px solid rgba(255,255,255,.12); border-radius:999px}

  nav.tabs{display:flex; gap:8px; padding:8px 12px; border-bottom:1px solid rgba(255,255,255,.06); background:#0f172a; overflow:auto; position:sticky; top:48px; z-index:999}
  .tab{padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.1); cursor:pointer; white-space:nowrap; background:#0b1222}
  .tab[aria-selected="true"]{background:rgba(96,165,250,.15); border-color:rgba(96,165,250,.6)}
  .page{display:none; height:100%}
  .page.active{display:block}

  .stageWrap{ display:grid; grid-template-columns:95px 1fr; height:calc(100vh - 210px); min-height:360px; position:relative; }
  @supports(height: 100dvh){ .stageWrap{ height:calc(100dvh - 210px); } }
  .leftRail{display:grid; grid-auto-rows:min-content; align-content:start; gap:10px; padding:10px; background:rgba(59,130,246,.14); border-right:1px solid rgba(255,255,255,.08); z-index:10; touch-action:none;}
  .btn{padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#1f2937; color:#fff; cursor:pointer; font-weight:700}
  .btn.playing{background:rgba(52,211,153,.28); border-color:rgba(52,211,153,.6)}
  #revealBtn, #nextPhoto{height:120px}

  .stage{ position:relative; display:grid; place-items:center; overflow:hidden; }
  .imgwrap{ position:relative; width:100%; height:100%; display:grid; place-items:center; }
  img.photo{ max-width:88vw; max-height:74vh; object-fit:contain; border-radius:16px; box-shadow:0 12px 32px rgba(0,0,0,.55); opacity:0; transition:opacity .18s ease; }
  img.photo.show{opacity:1}

  .nameOverlay{ position:absolute; left:50%; bottom:6%; transform:translateX(-50%); background:rgba(0,0,0,.72); border:1px solid rgba(255,255,255,.1); padding:12px 16px; border-radius:14px; text-align:center; max-width:min(92%, 880px) }
  .nameOverlay.collapsed{display:none}
  .title{font-size:22px; font-weight:800}
  .tags{margin-top:6px; font-size:13px; color:var(--muted)}

  .versionSticker{position:absolute; top:10px; left:110px; z-index:20; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.2); padding:6px 10px; border-radius:10px; font-size:12px}

  .builder{padding:12px}
  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:10px}
  .termBtn{padding:12px 14px; border-radius:12px; background:#111827; border:1px solid rgba(255,255,255,.22); cursor:pointer; text-align:left; user-select:none; color:#fff}
  .termBtn.selected{outline:2px solid var(--accent); background:#1f2937}
  .termBtn.editing{outline:2px dashed #fbbf24}
  .rowActions{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}

  footer{padding:10px 12px; display:flex; flex-wrap:wrap; gap:12px; align-items:center; color:#9fb7d6; background:#111827; z-index:1000}
  footer a{color:var(--ok); text-decoration:none}

  #swipeCatcher{ position:fixed; inset:0; z-index:998; background:transparent; }
  .noSwipe{ display:none !important; }

  .zonePrev, .zoneNext{ position:absolute; top:0; bottom:0; z-index:5; }
  .zonePrev{ left:95px; width:35%; }
  .zoneNext{ right:0; width:65%; }

  @media (max-width: 768px){ .stageWrap{grid-template-columns:84px 1fr} .zonePrev{ left:84px; } #revealBtn, #nextPhoto{height:100px} }
</style>
</head>
<body>
  <header>
    <h1>üß∞ Objects 01 - v02</h1>
    <span class="badge" id="countBadge">0 photos</span>
    <div class="sp"></div>
    <button class="iconBtn" id="gearBtn" title="Settings (toggle)">‚öôÔ∏è</button>
    <button class="iconBtn" id="openLink" title="Open file page">üîó</button>
  </header>

  <nav class="tabs" role="tablist">
    <button class="tab" role="tab" aria-controls="page1" aria-selected="true" id="tab1">Page 1: Slideshow</button>
    <button class="tab" role="tab" aria-controls="page2" aria-selected="false" id="tab2">Page 2: Locations A</button>
    <button class="tab" role="tab" aria-controls="page3" aria-selected="false" id="tab3">Page 3: Locations B</button>
    <button class="tab" role="tab" aria-controls="page4" aria-selected="false" id="tab4">Page 4: Locations C</button>
    <button class="tab" role="tab" aria-controls="page5" aria-selected="false" id="tab5">Page 5: Settings</button>
  </nav>

  <main>
    <section id="page1" class="page active" role="tabpanel" aria-labelledby="tab1">
      <div class="stageWrap">
        <div class="leftRail">
          <button id="hideAllNames" class="btn">Hide</button>
          <button id="cornerPlayStop" class="btn">‚ñ∂Ô∏è</button>
          <button id="revealBtn" class="btn">Reveal</button>
          <button id="nextPhoto" class="btn">Next</button>
        </div>
        <div class="stage">
          <div class="versionSticker" id="versionSticker">Objects 01 ‚Äî v02</div>
          <div class="imgwrap" id="imgwrap"></div>
          <div class="nameOverlay collapsed" id="nameBar">
            <div class="title" id="entityName">&nbsp;</div>
            <div class="tags" id="entityTags"></div>
          </div>
          <div class="zonePrev" id="zonePrev" title="Previous"></div>
          <div class="zoneNext" id="zoneNext" title="Next"></div>
        </div>
      </div>
      <div id="swipeCatcher" class="noSwipe"></div>
    </section>

    <section id="page2" class="page" role="tabpanel" aria-labelledby="tab2">
      <div class="builder">
        <div class="grid" id="gridLoc1"></div>
        <div class="rowActions"><button class="btn" id="clearAll2">Clear All</button></div>
      </div>
    </section>

    <section id="page3" class="page" role="tabpanel" aria-labelledby="tab3">
      <div class="builder">
        <div class="grid" id="gridLoc2"></div>
        <div class="rowActions"><button class="btn" id="clearAll3">Clear All</button></div>
      </div>
    </section>

    <section id="page4" class="page" role="tabpanel" aria-labelledby="tab4">
      <div class="builder">
        <div class="grid" id="gridLoc3"></div>
        <div class="rowActions"><button class="btn" id="clearAll4">Clear All</button></div>
      </div>
    </section>

    <section id="page5" class="page" role="tabpanel" aria-labelledby="tab5">
      <div class="builder" style="max-width:720px; display:grid; gap:12px">
        <div><strong>Slide speed</strong> (seconds)</div>
        <input id="speedInput" type="number" step="0.2" min="0.2" value="4" />
        <div><strong>Name reveal delay</strong> (seconds)</div>
        <input id="revealInput" type="number" step="0.2" min="0" value="2" />
        <div class="rowActions">
          <button class="btn" id="applySettings">Apply settings</button>
          <span id="settingsNote" style="color:#9fb7d6"></span>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div>
      PC: Right-side keys ‚áí Next, Left-side ‚áí Previous. <kbd>S</kbd> ‚áí Reveal. <kbd>Space</kbd> ‚áí Play/Pause. <kbd>Alt</kbd>+<kbd>C</kbd> ‚áí Clear All.
      Mobile: swipe left/right; tap left/right of photo for prev/next. Triple-click a tile to rename.
    </div>
    <div class="sp"></div>
    <a href="#" id="downloadLink" title="Download current image">Download</a>
  </footer>

<script>
(function(){
  /* Tabs / Pages */
  const tabs=[1,2,3,4,5].map(i=>({tab:document.getElementById('tab'+i),page:document.getElementById('page'+i)}));
  const swipeCatcher = document.getElementById('swipeCatcher');
  function activePageIndex(){ return tabs.findIndex(t=> t.page.classList.contains('active')); }
  function setPage(idx){ tabs.forEach((t,i)=>{ const on=(i===idx-1); t.page.classList.toggle('active', on); t.tab.setAttribute('aria-selected', String(on)); }); if(idx===1){ swipeCatcher.classList.remove('noSwipe'); } else { swipeCatcher.classList.add('noSwipe'); } }
  tabs.forEach((t,i)=> t.tab.addEventListener('click',()=> setPage(i+1)));
  document.getElementById('gearBtn').addEventListener('click', ()=>{ const i=activePageIndex()+1; setPage(i===5?1:5); });

  /* Swipe support */
  let sx=0, sy=0, swiping=false;
  swipeCatcher.addEventListener('touchstart', e=>{ if(e.touches.length!==1) return; swiping=true; sx=e.touches[0].clientX; sy=e.touches[0].clientY; }, {passive:false});
  swipeCatcher.addEventListener('touchmove', e=>{ if(!swiping) return; const dx=e.touches[0].clientX - sx; const dy=e.touches[0].clientY - sy; if(Math.abs(dx)>Math.abs(dy)) e.preventDefault(); }, {passive:false});
  swipeCatcher.addEventListener('touchend', e=>{ if(!swiping) return; swiping=false; const t=e.changedTouches[0]; const dx=t.clientX - sx, dy=t.clientY - sy; if(Math.abs(dx)>40 && Math.abs(dy)<60){ const i=activePageIndex()+1; if(dx<0 && i<5) setPage(i+1); if(dx>0 && i>1) setPage(i-1); } }, {passive:false});

  /* Locations */
  const LOCATIONS = [
    'Office','Tax office','Restaurant','Doctor\'s office','Hospital','School classroom','University lab','Construction site','Factory floor','Warehouse',
    'Supermarket','Bakery','Home kitchen','Coffee shop','Bar / pub','Theater stage','Film set','Music studio','Art studio','Museum gallery',
    'Library','Gym','Sports stadium','Airport terminal','Train station','Police station','Fire station','Courthouse','Post office','The Moon',
    'Farmer\'s market','School dance','Hardware store','Pharmacy','Beauty salon','Barbershop','Hotel lobby','Kitchen supply store','Flower shop','Public park',
    'Beach','Playground','City street','Subway','Bus stop','Camping site','Garage','Living room','Class reunion','Open mic night',
    'Emotions: 1 person','Emotions: two people','Emotions: more than three',
    'Poses: 1 person','Poses: 2 people','Poses: 3 people','Poses by dancers','People resembling something else'
  ];

  /* Commons categories */
  const MAP_CATS = {
    'Office':[ 'Office_equipment','Desks','Office_chairs','Computers_in_offices','Printers','Stationery','Office_workers','Secretaries','Delivery_people' ],
    'Restaurant':[ 'Restaurant_equipment','Tableware','Menus','Waiters','Chefs','Cash_registers' ],
    'Doctor\'s office':[ 'Medical_equipment','Stethoscopes','Waiting_rooms','Reception_desks' ],
    'Hospital':[ 'Hospital_equipment','Operating_rooms','Ambulances_(interiors)','IV_drips' ],
    'School classroom':[ 'Classrooms','Blackboards','Whiteboards','School_desks','School_supplies' ],
    'University lab':[ 'Laboratory_equipment','Microscopes','Glassware','Fume_hoods' ],
    'Construction site':[ 'Construction_tools','Excavators','Cranes_(machines)','Safety_helmets' ],
    'Factory floor':[ 'Industrial_machinery','Assembly_lines','Conveyor_belts','Forklift_trucks' ],
    'Warehouse':[ 'Warehouse_racking','Pallets','Forklift_trucks','Bar_code_scanners' ],
    'Supermarket':[ 'Shopping_carts','Shelving','Bar_code_scanners','Checkout_counters' ],
    'Bakery':[ 'Bakeries','Ovens','Bread','Rolling_pins' ],
    'Home kitchen':[ 'Kitchen_utensils','Cookware','Refrigerators','Cutting_boards' ],
    'Coffee shop':[ 'Espresso_machines','Coffee_grinders','To_go_cups','Baristas' ],
    'Bar / pub':[ 'Bartending_tools','Beer_taps','Glasses','Cocktail_shakers' ],
    'Theater stage':[ 'Stage_lighting_equipment','Microphones','Props','Curtains_(theatre)' ],
    'Film set':[ 'Film_cameras','Clapperboards','Boom_microphones','Light_stands' ],
    'Music studio':[ 'Audio_mixers','Headphones','Microphones','Synthesizers' ],
    'Art studio':[ 'Easels','Paintbrushes','Palettes','Canvases' ],
    'Museum gallery':[ 'Display_cases','Audio_guides','Gallery_benches' ],
    'Library':[ 'Bookshelves','Library_circulation_desks','Library_cards' ],
    'Gym':[ 'Dumbbells','Treadmills','Kettlebells','Yoga_mats' ],
    'Sports stadium':[ 'Scoreboards','Turnstiles','Bleachers','Goal_posts' ],
    'Airport terminal':[ 'Check-in_counters','Boarding_pass_scanners','Baggage_carousels' ],
    'Train station':[ 'Ticket_vending_machines','Platforms_(railways)','Turnstiles' ],
    'Police station':[ 'Handcuffs','Police_radios','Evidence_bags' ],
    'Fire station':[ 'Firefighting_equipment','Fire_helmets','Turnout_gear' ],
    'Courthouse':[ 'Courtrooms','Gavels','Court_benches' ],
    'Post office':[ 'Mail_sorting','Postboxes','Scales' ],
    'The Moon':[ 'Apollo_equipment','Lunar_samples','Space_suits' ],
    'Farmer\'s market':[ 'Farmers_markets','Vegetables','Fruit_stalls','Cash_boxes' ],
    'School dance':[ 'School_dances','Balloon_decorations','Disco_balls' ],
    '
